{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://asd-engineering.github.io/asd-caddy-api-client/schemas/caddy-handler.json",
  "title": "Caddy Handler",
  "description": "Caddy HTTP handler (reverse_proxy, headers, etc.)",
  "$ref": "#/definitions/caddy-handler",
  "definitions": {
    "caddy-handler": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "reverse_proxy"
            },
            "upstreams": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "dial": {
                    "type": "string",
                    "minLength": 1
                  },
                  "max_requests": {
                    "type": "integer",
                    "exclusiveMinimum": 0
                  }
                },
                "required": ["dial"],
                "additionalProperties": false
              }
            },
            "load_balancing": {
              "type": "object",
              "properties": {
                "selection_policy": {
                  "type": "object",
                  "properties": {
                    "policy": {
                      "type": "string",
                      "enum": [
                        "first",
                        "random",
                        "least_conn",
                        "round_robin",
                        "ip_hash",
                        "uri_hash",
                        "header",
                        "cookie"
                      ]
                    }
                  },
                  "required": ["policy"],
                  "additionalProperties": true
                },
                "retries": {
                  "type": "integer",
                  "minimum": 0
                },
                "try_duration": {
                  "anyOf": [
                    {
                      "type": "integer"
                    },
                    {
                      "type": "string",
                      "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                    }
                  ]
                },
                "try_interval": {
                  "anyOf": [
                    {
                      "type": "integer"
                    },
                    {
                      "type": "string",
                      "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                    }
                  ]
                }
              },
              "additionalProperties": false
            },
            "health_checks": {
              "type": "object",
              "properties": {
                "active": {
                  "type": "object",
                  "properties": {
                    "uri": {
                      "type": "string"
                    },
                    "path": {
                      "type": "string"
                    },
                    "port": {
                      "type": "integer",
                      "exclusiveMinimum": 0,
                      "maximum": 65535
                    },
                    "headers": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "follow_redirects": {
                      "type": "boolean"
                    },
                    "interval": {
                      "anyOf": [
                        {
                          "type": "integer"
                        },
                        {
                          "type": "string",
                          "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                        }
                      ]
                    },
                    "timeout": {
                      "anyOf": [
                        {
                          "type": "integer"
                        },
                        {
                          "type": "string",
                          "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                        }
                      ]
                    },
                    "passes": {
                      "type": "integer",
                      "exclusiveMinimum": 0
                    },
                    "fails": {
                      "type": "integer",
                      "exclusiveMinimum": 0
                    },
                    "max_size": {
                      "type": "integer",
                      "exclusiveMinimum": 0
                    },
                    "expect_status": {
                      "type": "integer",
                      "minimum": 100,
                      "maximum": 599
                    },
                    "expect_body": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                },
                "passive": {
                  "type": "object",
                  "properties": {
                    "fail_duration": {
                      "anyOf": [
                        {
                          "type": "integer"
                        },
                        {
                          "type": "string",
                          "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                        }
                      ]
                    },
                    "max_fails": {
                      "type": "integer",
                      "exclusiveMinimum": 0
                    },
                    "unhealthy_request_count": {
                      "type": "integer",
                      "exclusiveMinimum": 0
                    },
                    "unhealthy_status": {
                      "type": "array",
                      "items": {
                        "type": "integer",
                        "minimum": 100,
                        "maximum": 599
                      }
                    },
                    "unhealthy_latency": {
                      "anyOf": [
                        {
                          "type": "integer"
                        },
                        {
                          "type": "string",
                          "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                        }
                      ]
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "transport": {
              "type": "object",
              "properties": {
                "protocol": {
                  "type": "string"
                }
              },
              "required": ["protocol"],
              "additionalProperties": true
            },
            "flush_interval": {
              "anyOf": [
                {
                  "type": "integer"
                },
                {
                  "type": "string",
                  "pattern": "^\\d+(\\.\\d+)?(ns|us|µs|ms|s|m|h|d)$"
                }
              ]
            },
            "request_buffers": {
              "type": "integer",
              "minimum": 0
            },
            "response_buffers": {
              "type": "integer",
              "minimum": 0
            },
            "headers": {
              "type": "object",
              "properties": {
                "request": {
                  "type": "object",
                  "properties": {
                    "add": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "set": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "delete": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "additionalProperties": false
                },
                "response": {
                  "type": "object",
                  "properties": {
                    "add": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "set": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "delete": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "headers"
            },
            "response": {
              "type": "object",
              "properties": {
                "deferred": {
                  "type": "boolean"
                },
                "set": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "add": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "delete": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false
            },
            "request": {
              "type": "object",
              "properties": {
                "set": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "add": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "delete": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "static_response"
            },
            "status_code": {
              "anyOf": [
                {
                  "type": "integer",
                  "minimum": 100,
                  "maximum": 599
                },
                {
                  "type": "string"
                }
              ]
            },
            "body": {
              "type": "string"
            },
            "headers": {
              "type": "object",
              "additionalProperties": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "close": {
              "type": "boolean"
            },
            "abort": {
              "type": "boolean"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "authentication"
            },
            "providers": {
              "type": "object",
              "properties": {
                "http_basic": {
                  "type": "object",
                  "properties": {
                    "accounts": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "username": {
                            "type": "string"
                          },
                          "password": {
                            "type": "string"
                          }
                        },
                        "required": ["username", "password"],
                        "additionalProperties": false
                      }
                    },
                    "realm": {
                      "type": "string"
                    },
                    "hash": {
                      "type": "object",
                      "properties": {
                        "algorithm": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "rewrite"
            },
            "uri": {
              "type": "string"
            },
            "strip_path_prefix": {
              "type": "string"
            },
            "strip_path_suffix": {
              "type": "string"
            },
            "uri_substring": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "find": {
                    "type": "string"
                  },
                  "replace": {
                    "type": "string"
                  },
                  "limit": {
                    "type": "integer"
                  }
                },
                "required": ["find", "replace"],
                "additionalProperties": false
              }
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "encode"
            },
            "encodings": {
              "type": "object",
              "properties": {
                "gzip": {
                  "type": "object",
                  "properties": {},
                  "additionalProperties": true
                },
                "zstd": {
                  "type": "object",
                  "properties": {},
                  "additionalProperties": true
                },
                "br": {
                  "type": "object",
                  "properties": {},
                  "additionalProperties": true
                }
              },
              "additionalProperties": true
            },
            "prefer": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "minimum_length": {
              "type": "integer",
              "exclusiveMinimum": 0
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "fs": {
              "type": "string"
            },
            "root": {
              "type": "string"
            },
            "hide": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "index_names": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "browse": {
              "type": "object",
              "properties": {
                "template_file": {
                  "type": "string"
                },
                "reveal_symlinks": {
                  "type": "boolean"
                },
                "sort": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "file_limit": {
                  "type": "number"
                }
              },
              "additionalProperties": false
            },
            "canonical_uris": {
              "type": "boolean"
            },
            "status_code": {},
            "pass_thru": {
              "type": "boolean"
            },
            "precompressed": {},
            "precompressed_order": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "etag_file_extensions": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "handler": {
              "type": "string",
              "const": "file_server"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "file_root": {
              "type": "string"
            },
            "mime_types": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "delimiters": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "match": {},
            "handler": {
              "type": "string",
              "const": "templates"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "source": {
              "type": "string"
            },
            "destinations": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "mappings": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "input": {
                    "type": "string"
                  },
                  "input_regexp": {
                    "type": "string"
                  },
                  "outputs": {
                    "type": "array"
                  }
                },
                "additionalProperties": false
              }
            },
            "defaults": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "handler": {
              "type": "string",
              "const": "map"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "resources": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "method": {
                    "type": "string"
                  },
                  "target": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            },
            "headers": {
              "type": "object",
              "properties": {
                "HeaderOps": {}
              },
              "additionalProperties": false
            },
            "handler": {
              "type": "string",
              "const": "push"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "max_size": {
              "type": "number"
            },
            "read_timeout": {
              "type": ["number", "string"]
            },
            "write_timeout": {
              "type": ["number", "string"]
            },
            "set": {
              "type": "string"
            },
            "handler": {
              "type": "string",
              "const": "request_body"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "vars"
            }
          },
          "required": ["handler"],
          "additionalProperties": true
        },
        {
          "type": "object",
          "properties": {
            "handle_response": {
              "type": "array"
            },
            "handler": {
              "type": "string",
              "const": "intercept"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "handler": {
              "type": "string",
              "const": "invoke"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "span": {
              "type": "string"
            },
            "handler": {
              "type": "string",
              "const": "tracing"
            }
          },
          "required": ["span", "handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "key": {
              "type": "string"
            },
            "value": {
              "type": "string"
            },
            "handler": {
              "type": "string",
              "const": "log_append"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "error": {
              "type": "string"
            },
            "status_code": {
              "type": "string"
            },
            "handler": {
              "type": "string",
              "const": "error"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "status_code": {},
            "handler": {
              "type": "string",
              "const": "copy_response"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "include": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "exclude": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "handler": {
              "type": "string",
              "const": "copy_response_headers"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "subroute"
            },
            "routes": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "@id": {
                    "type": "string"
                  },
                  "match": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "host": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "path": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "method": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"]
                          }
                        },
                        "header": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        },
                        "query": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "handle": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "handler": {
                          "type": "string"
                        }
                      },
                      "required": ["handler"],
                      "additionalProperties": true
                    },
                    "minItems": 1
                  },
                  "terminal": {
                    "type": "boolean"
                  },
                  "priority": {
                    "type": "integer"
                  }
                },
                "required": ["handle"],
                "additionalProperties": false
              }
            },
            "errors": {}
          },
          "required": ["handler"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "handler": {
              "type": "string",
              "const": "authenticator"
            },
            "portal_name": {
              "type": "string"
            },
            "route_matcher": {
              "type": "string"
            }
          },
          "required": ["handler"],
          "additionalProperties": false
        }
      ]
    }
  }
}
